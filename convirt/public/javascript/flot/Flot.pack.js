if(typeof _!="function"){_=function(A){return A}}Ext.ux.Flot=Ext.extend(Ext.BoxComponent,{version:"0.10",type:"auto",sortType:Ext.data.SortTypes.asFloat,contextMenu:[{name:"select",text:_("Select"),iconCls:"cursor",handler:function(){this.setSelectionAction("select")}},{name:"zoom",text:_("Zoom"),iconCls:"magnifier_zoom",handler:function(){this.setSelectionAction("zoom")}},{name:"move",text:_("Move"),iconCls:"arrow_move",handler:function(){this.setSelectionAction("move")}},"-",{name:"actual",text:_("100%"),iconCls:"magnifier_zoom_actual",handler:function(){this.zoomRatio(1)}},"-",{name:"selectall",text:_("Select All"),handler:function(){this.selectAll()}},{name:"unselectall",text:_("Unselect All"),handler:function(){this.unselectAll()}},"-",{name:"property",text:_("Property"),iconCls:"puzzle",handler:function(){this.showProperty()}}],datapointContextMenu:[{name:"selectalldatapoint",text:_("Select All Points"),iconCls:"flag_plus",handler:function(){var A=this.clickItem||this.hoverItem;if(A){this.selectAll(A.series)}}},{name:"unselectalldatapoint",text:_("Unselect All Points"),iconCls:"flag_minus",handler:function(){var A=this.clickItem||this.hoverItem;if(A){this.unselectAll(A.series)}}},"-",{name:"showseries",text:_("Show Series"),iconCls:"database_plus",handler:function(){var A=this.clickItem||this.hoverItem;if(A){this.setHidden(A.series,false)}}},{name:"hideseries",text:_("Hide Series"),iconCls:"database_minus",handler:function(){var A=this.clickItem||this.hoverItem;if(A){this.setHidden(A.series,true)}}}],tooltip:true,tooltipEvent:"plothover",initComponent:function(){Ext.applyIf(this,{grid:{},xaxis:{},yaxis:{},selection:{},crosshair:{}});Ext.applyIf(this.grid,{clickable:true,hoverable:true});Ext.applyIf(this.selection,{mode:"xy",action:"select",appendKey:"shiftKey",zoomDirection:"tb",zoomWindow:"expand",cursor:{}});Ext.applyIf(this.selection.cursor,{select:"default",zoom:"crosshair",move:"move"});this.store=this.store||new Ext.data.JsonStore({});this.selected=[];this.actions={};var F=["contextMenu","datapointContextMenu"];for(var B=0;B<F.length;B++){var E=F[B];if(this[E]){var H=[];var D=this[E];for(var C=0,A=D.length;C<A;C++){if(typeof D[C]=="object"){var G=new Ext.Action(Ext.apply({scope:this},D[C]));this.actions[D[C].name]=G;H.push(G)}else{H.push(D[C])}}this[E]=H}}Ext.ux.Flot.superclass.initComponent.call(this);this.addEvents("click","dblclick","contextmenu","beforedraw","draw","plotselected","plotselecting","plothover","plotclick","plotshow","plothide","selectionactionchange","selectionchange","legendclick")},createStoreData:function(G){G=G||this.getData();var L=this.getAxes();var J=[];var P=["xaxis","x2axis"];for(var C=0;C<P.length;C++){J.push({name:P[C],xColumn:true,type:this.type,sortType:this.sortType})}var F={};for(var H=0,K=G.length;H<K;H++){var Q=G[H];var B=Q.label||H;var N=(Q.xaxis==L.x2axis)?"x2axis":"xaxis";J.push({name:B,type:this.type,sortType:this.sortType});for(var D=0,I=Q.data.length;D<I;D++){var A=Q.data[D];if(A){var M=F[A[0]]=F[A[0]]||{};M[N]=A[0];M[B]=A[1]}}}var E=[];for(var O in F){E.push(F[O])}return{metaData:{root:"data",totalProperty:"total",successProperty:"success",sortInfo:{field:"xaxis",direction:"ASC"},fields:J},data:E,total:E.length,success:true}},createSeries:function(C,G){C=C||this.store;if(typeof G=="undefined"){G=C.xField}var F,B;var E=[];for(F=0,B=C.fields.keys.length;F<B;F++){var D=C.fields.items[F];var A=D.dataIndex||D.name;if(G==A){continue}E.push({label:D.name,dataIndex:A,type:this.type,sortType:this.sortType,data:[]})}C.each(function(N){var L=this.series;var J=this.store;var I=N.get(this.xField);for(var K=0,H=L.length;K<H;K++){var M=N.get(L[K].dataIndex);L[K].data.push([I,M])}},{series:E,store:C,xField:G});return E},getStore:function(){return this.store},clipData:function(A){var E=this.getData();var I=this.getAxes();var D=[];for(var F=0,G=E.length;F<G;F++){var L=E[F];D[F]={};D[F].series=L;D[F].datapoints=[];var K=L.xaxis==I.x2axis?"x2axis":"xaxis";var J=L.yaxis==I.y2axis?"y2axis":"yaxis";for(var C=0,B=L.data.length;C<B;C++){var H=L.data[C];if(H&&A[K].from<=H[0]&&A[K].to>=H[0]&&A[J].from<=H[1]&&A[J].to>=H[1]){D[F].datapoints.push([H[0],H[1]])}}}return D},onRender:function(F,E){if(!this.template){if(!Ext.ux.Flot.flotTemplate){Ext.ux.Flot.flotTemplate=new Ext.Template('<div id="{0}"></div>')}this.template=Ext.ux.Flot.flotTemplate}var A=this.id||Ext.id(null,"flot-container");var B,G=[A];if(E){B=this.template.insertBefore(E,G,true)}else{B=this.template.append(F,G,true)}this.el=B;if(this.id){this.el.dom.id=this.el.id=this.id}this.el.setWidth(this.width||F.getWidth());this.el.setHeight(this.height||F.getHeight());this.el.setStyle("cursor",this.selection.cursor[this.selection.action]);var C=this.series;if(this.data){C=this.setupData(this.data,C)}if(C){C=this.setupSeries(C);this.plot(C);C=this.getData();for(var D=0,H=C.length;D<H;D++){var I=C[D];if(I.hidden){I.hidden=!I.hidden;this.setHidden(I,!I.hidden)}}}},afterRender:function(){Ext.ux.Flot.superclass.afterRender.call(this);this.el.on({mousedown:this.onMouseDown,mouseup:this.onMouseUp,mouseout:this.onMouseOut,click:this.onClick,dblclick:this.onDblClick,contextmenu:this.onContextMenu,scope:this});$("#"+this.id).bind("plotselected",function(B,A){flot=Ext.getCmp(B.target.id);flot.onPlotSelected(B,A)});$("#"+this.id).bind("plotselecting",function(B,A){flot=Ext.getCmp(B.target.id);flot.onPlotSelecting(B,A)});$("#"+this.id).bind("plothover",function(B,C,A){flot=Ext.getCmp(B.target.id);flot.onPlotHover(B,C,A)});$("#"+this.id).bind("plotclick",function(B,C,A){flot=Ext.getCmp(B.target.id);flot.onPlotClick(B,C,A)});this.updateAction();if(this.tooltip){this.on(this.tooltipEvent,function(A,C,D,B){if(B){this.showTooltip(C,D,B,false)}},this)}},onResize:function(E,B,A,D){this.el.setWidth(E);this.el.setHeight(B);try{this.plot(this.getData())}catch(C){if(typeof C=="string"){this.onResize.defer(200,this,[E,B,A,D])}else{throw C}}this.syncSelected()},setupLegend:function(){var B=this.el.query("div.legend > table > tbody")[0];if(B){var E=this.getData();this.legendCmp=new Ext.Element(B);this.legendEls={};var L=this.legendCmp.query("tr > td.legendColorBox");var G=this.legendCmp.query("tr > td.legendLabel");for(var F=0,H=E.length;F<H;F++){var M=E[F];var J=-1;for(var D=0;D<G.length;D++){var K=G[D].textContent||G[D].innerHtml;if(K==M.label){J=D;break}}if(J>=0){var C=new Ext.Element(L[J]);var A=new Ext.Element(G[J]);C.on("click",this.onLegendClick,this,{series:M});A.on("click",this.onLegendClick,this,{series:M});var I=this.legendEls[M.label]||{};if(I.hidden!=M.hidden){(M.hidden)?C.fadeOut():C.fadeIn()}if(M.hidden){C.hide()}this.legendEls[M.label]=Ext.apply(I,{legendColorBox:C,legendLabel:A,series:M,hidden:M.hidden})}}}},onDraw:function(){this.setupLegend();this.store.loadData(this.createStoreData());if(!this.baseRanges){this.baseRanges=this.getRanges()}this.fireEvent("draw",this)},onSelectionChange:function(){this.updateAction();this.fireEvent("selectionchange",this,this.selected)},onLegendClick:function(D,C,A){var B=A.series;if(this.fireEvent("legendclick",this,Ext.get(C),B)!==false){this.setHidden(B,!B.hidden)}},onMouseDown:function(A){this.lastEvent=this.mouseDownEvent=Ext.apply({},A)},onMouseUp:function(A){this.lastEvent=this.mouseUpEvent=Ext.apply({},A)},onMouseOut:function(A){this.lastEvent=this.mouseUpEvent=Ext.apply({},A)},onClick:function(A){this.fireEvent("click",this,A)},onDblClick:function(B){if(this.fireEvent("dblclick",this,B)!==false){if(this.selection.action=="select"){this}else{var A=this.getRanges();if(this.isSameRanges(A,this.baseRanges)){if(this.currentRanges){this.zoom(this.currentRanges)}}else{this.zoom(this.baseRanges)}}}},onContextMenu:function(B){if(this.fireEvent("contextmenu",this,B)!==false){var A=this.contextMenu;if(this.clickItem){if(Math.abs(B.xy[0]-this.clickItem.pageX)<=5&&Math.abs(B.xy[1]-this.clickItem.pageY)<=5){A=this.datapointContextMenu||A}}if(A){var C=new Ext.menu.Menu({items:A});B.stopEvent();C.showAt(B.getXY())}}},onPlotSelecting:function(B,A){this.fireEvent("plotselecting",this,B,A)},onPlotSelected:function(X,C){if(this.fireEvent("plotselected",this,X,C)!==false){if(!this.mouseDownEvent||!this.mouseUpEvent){return }var D=[this.mouseDownEvent.xy[0]-this.mouseUpEvent.xy[0],this.mouseDownEvent.xy[1]-this.mouseUpEvent.xy[1]];var Y=this.getAxes();var N={};var L=["xaxis","yaxis","x2axis","y2axis"],T,B;switch(this.selection.action){case"select":if(!this.lastEvent[this.selection.appendKey]){this.unselectAll()}var g=this.clipData(C);var H=false;for(var Z=0,c=g.length;Z<c;Z++){for(var W=0,Q=g[Z].datapoints.length;W<Q;W++){if(this.addSelected(g[Z].series,g[Z].datapoints[W])){H=true}}}if(H){this.onSelectionChange()}break;case"zoom":var M,P,S,b;var E,F,e,f;var A={},V,I;var J=this.el.getWidth();var a=this.el.getHeight();var G=Math.abs(D[0]);var O=Math.abs(D[1]);var U=false,R=false;switch(this.selection.zoomWindow){case"ranges":break;case"expand":U=(G<O);R=(G>O);break;case"shrink":U=(G>O);R=(G<O);break;case"width":R=true;break;case"height":U=true;break;default:break}for(T=0;T<L.length;T++){B=L[T];if(!Y[B].used){A[B]=null;continue}A[B]=I={from:C[B].from,to:C[B].to,center:(C[B].from+C[B].to)/2,min:Y[B].min,max:Y[B].max,axisLength:Y[B].max-Y[B].min,rangeLength:C[B].to-C[B].from};var n=null;if(B[0]=="x"&&U){n=O/G*J/a}else{if(B[0]=="y"&&R){n=G/O*a/J}}if(n!==null){I.fromOrg=I.from;I.toOrg=I.to;I.from=I.center+(I.from-I.center)*n;I.to=I.center+(I.to-I.center)*n;I.rangeLength=I.to-I.from}}switch(this.selection.zoomDirection){case"tb":V=D[1]>=0;break;case"bt":V=D[1]<=0;break;case"lr":V=D[0]>=0;break;case"rl":V=D[0]<=0;break;default:V=D[1]>=0;break}for(T=0;T<L.length;T++){B=L[T];I=A[B];if(!I){continue}if(V){N[B]={min:I.from,max:I.to}}else{N[B]={min:I.min+(I.min-I.from)*I.axisLength/I.rangeLength,max:I.max+(I.max-I.to)*I.axisLength/I.rangeLength}}}this.zoom(N);break;case"move":var m=(D[0]<=0)?true:false;var l=(D[1]>=0)?true:false;for(T=0;T<L.length;T++){B=L[T];if(!Y[B].used){continue}var K=C[B].to-C[B].from;K=((B[0]=="x")?m:l)?-K:K;N[B]={min:Y[B].min+K,max:Y[B].max+K}}this.zoom(N);break;default:break}}},onPlotHover:function(B,C,A){this.hoverItem=A;this.fireEvent("plothover",this,B,C,A)},onPlotClick:function(B,C,A){this.clickItem=A;if(this.fireEvent("plotclick",this,B,C,A)!==false){if(A){if(A.series.selectable){if(!this.lastEvent[this.selection.appendKey]){this.unselectAll()}if(!this.addSelected(A.series,A.datapoint)){this.removeSelected(A.series,A.datapoint)}this.onSelectionChange()}}else{if(!this.lastEvent[this.selection.appendKey]){this.unselectAll()}}}},setSelectionAction:function(A){this.selection.action=A;this.el.setStyle("cursor",this.selection.cursor[this.selection.action]);this.updateAction();this.fireEvent("selectionactionchange",this,A)},getSelectionAction:function(){return this.selection.action},getRanges:function(){var A=this.getData();var C=this.getAxes();var B={};if(C.xaxis){B.xaxis={min:C.xaxis.min,max:C.xaxis.max}}if(C.yaxis){B.yaxis={min:C.yaxis.min,max:C.yaxis.max}}if(C.x2axis){B.x2axis={min:C.x2axis.min,max:C.x2axis.max}}if(C.y2axis){B.y2axis={min:C.y2axis.min,max:C.y2axis.max}}return B},isSameRanges:function(E,B){var G=["xaxis","yaxis","x2axis","y2axis"];for(var D=0;D<G.length;D++){var F=G[D];var C=E[F],A=B[F];if(C.min!=A.min&&C.max!=A.max){return false}}return true},zoom:function(A){var E=["xaxis","yaxis","x2axis","y2axis"];for(var B=0;B<E.length;B++){var C=E[B];var D=A[C];if(D){if(typeof D.min=="undefined"){D.min=D.from}if(typeof D.max=="undefined"){D.max=D.to}Ext.apply(this[C],D)}}this.plot(this.getData());A=this.getRanges();if(!this.isSameRanges(A,this.baseRanges)){this.currentRanges=A}},zoomRatio:function(B){var A=this.baseRanges;var C={};if(A.xaxis){C.xaxis={min:A.xaxis.min*B,max:A.xaxis.max*B}}if(A.yaxis){C.yaxis={min:A.yaxis.min*B,max:A.yaxis.max*B}}if(A.x2axis){C.x2axis={min:A.x2axis.min*B,max:A.x2axis.max*B}}if(A.y2axis){C.y2axis={min:A.y2axis.min*B,max:A.y2axis.max*B}}this.zoom(C)},syncSelected:function(){for(var B=0;B<this.selected.length;B++){var C=this.selected[B];C.series=this.findSeries(C.series.id);for(var A=0;A<C.datapoints.length;A++){this.highlight(C.series,C.datapoints[A])}}},addSelectedPoint:function(A,B){i=A.datapoints.indexOf(B);if(i<0){A.datapoints.push(B);this.highlight(A.series,B);return true}return false},addSelected:function(C,E){if(!this.selection||!C.selectable){return false}var D=null,B,A;for(B=0,A=this.selected.length;B<A;B++){if(this.selected[B].series==C){D=this.selected[B];break}}if(!D){D={series:C,datapoints:[]};this.selected.push(D)}return this.addSelectedPoint(D,E)},selectAll:function(G){if(!this.selection){return }if(typeof G=="string"){G=this.findSeries(G)}var H=false;var D=this.getData();this.selected=[];for(var C=0,A=D.length;C<A;C++){if(typeof G!="undefined"&&G!=D[C]){continue}if(!D[C].selectable){continue}var E={series:D[C],datapoints:[]};this.selected.push(E);for(var B=0,F=D[C].data.length;B<F;B++){if(this.addSelectedPoint(E,D[C].data[B])){H=true}}}if(H){this.onSelectionChange()}},removeSelected:function(C,E){for(var B=0,A=this.selected.length;B<A;B++){var D=this.selected[B];if(D.series==C){this.unhighlight(C,E);D.datapoints.remove(E);break}}},unselectAll:function(F){var G=false;if(typeof F=="string"){F=this.findSeries(F)}for(var C=0,A=this.selected.length;C<A;C++){var D=this.selected[C];if(typeof F!="undefined"&&F!=D.series){continue}for(var B=0,E=D.datapoints.length;B<E;B++){this.unhighlight(D.series,D.datapoints[B])}G=true;D.datapoints=[]}if(G){this.onSelectionChange()}},getSelected:function(){return this.selected},getSelectedRecords:function(C){var A=[];C=C||this.getSelected();for(var E=0,H=C.length;E<H;E++){for(var D=0,F=C[E].datapoints.length;D<F;D++){var B=C[E].datapoints[D];var G=C[E].series.x2axis?"x2axis":"xaxis";var I=this.store.find(G,B[0]);A.push(this.store.getAt(I))}}return A},setActionDisabled:function(A,B){if(this.actions[A]){this.actions[A].setDisabled(B)}},updateAction:function(){this.setActionDisabled("zoom",this.selection.action==="zoom");this.setActionDisabled("select",this.selection.action==="select");this.setActionDisabled("move",this.selection.action==="move");var D=0,B,A;for(B=0,A=this.selected.length;B<A;B++){D+=this.selected[B].datapoints.length}this.setActionDisabled("unselectall",this.selected.length===0||D===0);this.setActionDisabled("property",!this.hasProperty());var C=this.clickItem||this.hoverItem;if(C){D=0;for(B=0,A=this.selected.length;B<A;B++){if(this.selected[B].series==C.series){D=this.selected[B].datapoints.length;break}}this.setActionDisabled("selectalldatapoint",!C.series);this.setActionDisabled("unselectalldatapoint",!C.series||D===0);this.setActionDisabled("showseries",!C.series.hidden);this.setActionDisabled("hideseries",C.series.hidden)}},hasProperty:function(){return true},showProperty:function(){if(!this.propertyCmp){this.propertyCmp=new Ext.Window({closeAction:"hide",layout:"fit",width:400,height:300,items:[{xtype:"flotpropertygrid",flot:this,layout:"fit"}]});var A=this.propertyCmp.findByType("flotpropertygrid")[0];this.bindGrid(A)}this.propertyCmp.show()},bindGrid:function(A){this.on("selectionchange",function(B,F){var D=B.getSelectedRecords(F);var K=this.getColumnModel();var C=this.getSelectionModel();for(var G=0,H=D.length;G<H;G++){var E=D[G];var J=this.store.indexOf(E);for(var L in E.data){if(typeof E.data.key!="undefined"){var I=K.findColumnIndex(L);C.select(J,I)}}}},A);A.getSelectionModel().on("selectionchange",function(B){},this)},showTooltip:function(A,H,L,J){if(!this.tooltip||this.disableTooltip){return null}if(!J&&this.prevTooltipItem&&this.prevTooltipItem.datapoint[0]==L.datapoint[0]&&this.prevTooltipItem.datapoint[1]==L.datapoint[1]&&this.prevTooltipItem.series==L.series){return null}this.clearTooltip(this.tooltipCmp);this.prevTooltipItem=L;var N=L.series;var F=this.getAxes();var K=(N.xaxis)?N.xaxis:N.x2axis;var I=(N.yaxis)?N.yaxis:N.y2axis;var C=[];F=[K,I];for(var D=0;D<2;D++){try{C[D]=F[D].tickFormatter(L.datapoint[D],F[D])}catch(E){C[D]=L.datapoint[D]}}var B={tipId:A.target.id+"-tip",pageX:H.pageX,pageY:H.pageY,x:H.x,y:H.y,0:C[0],1:C[1],datapointX:L.datapoint[0],datapointY:L.datapoint[1],label:L.series.label,color:L.series.color,shadowSize:L.series.shadowSize,dataIndex:L.dataIndex,seriesIndex:L.seriesIndex,series:L.series};var G={renderTo:Ext.getBody(),targetXY:[H.pageX,H.pageY]};var M=this.tooltip;if(typeof M=="boolean"){M='<div id="{tipId}">{label} ({0}, {1})</div>'}if(typeof M=="string"){if(!this.tipTemplate){this.tipTemplate=new Ext.XTemplate(M)}G.html=this.tipTemplate.apply(B)}else{if(typeof M=="object"){Ext.apply(G,this.tooltip)}else{if(typeof M=="function"){G.html=M.call(this,B)}}}this.tooltipCmp=new Ext.ToolTip(G);this.tooltipCmp.show();this.tooltipCmp.on("hide",function(O){this.clearTooltip(O)},this);return this.tooltipCmp},clearTooltip:function(A){A=A||this.tooltipCmp;if(!A){return }this.prevTooltipItem=null;if(A==this.tooltipCmp){this.tooltipCmp=null}A.destroy()},setTooltipDisable:function(A){this.disableTooltip=A},findSeries:function(C){var E=this.getData();for(var D=0,B=E.length;D<B;D++){var A=E[D].dataIndex||E[D].label;if(C===A||C===E[D].id){return E[D]}}return null},setupSeries:function(C){if(typeof C.length=="undefined"){C=[C]}for(var B=0,A=C.length;B<A;B++){var D=C[B];if(typeof D.length!="undefined"){D=C[B]={data:D}}Ext.apply(D,this.baseSeries);Ext.applyIf(D,{id:Ext.id(null,"flot-series"),legend:Ext.apply({},D.legend),selectable:true,hidden:false})}return C},plot:function(C){var F=[];for(var B=0,A=C.length;B<A;B++){F.push(Ext.apply({},C[B]));if(this.flot){var E=this.getAxes();var D=F[B];if(D.xaxis&&typeof D.xaxis!="number"){D.xaxis=(D.xaxis==E.x2axis)?"2":"1"}if(D.yaxis&&typeof D.yaxis!="number"){D.yaxis=(D.yaxis==E.y2axis)?"2":"1"}}}if(this.fireEvent("beforedraw",this,F)!==false){this.flot=$.plot($("#"+this.id),F,this);this.onDraw()}},insertSeries:function(B,A){var C;C=(this.flot)?this.getData():[];if(A<0){A=C.length}C.splice(A,0,B);C=this.setupSeries(C);for(i=0;i<C.length;i++){delete C[i].color}if(this.flot){this.setData(C);this.redraw()}else{this.series=C}},prependSeries:function(A){this.insertSeries(A,0)},appendSeries:function(A){this.insertSeries(A,-1)},insertData:function(D,C,A){var E=this.setupData(D,C);for(var B=0;B<E.length;B++){this.insertSeries(C[B],(A<0)?A:A+B)}},prependData:function(B,A){this.insertData(B,A,0)},appendData:function(B,A){this.insertData(B,A,-1)},redraw:function(){var A=this.getData();if(this.fireEvent("beforedraw",this,A)!==false){this.setupGrid();this.draw();this.onDraw()}},setHidden:function(D,G){var E=(typeof D=="string")?this.findSeries(D):D;if(E.hidable===false){return }var F=["lines","points","bars","pies"];if(E.hidden!=G){E.hidden=G;for(var B=0,A=F.length;B<A;B++){var C=F[B];if(G){E[C+"Show"]=E[C];E[C]=Ext.applyIf({show:false,lineWidth:0,fill:0},E[C])}else{E[C]=E[C+"Show"]||E[C]}}if(G){E.colorShow=E.color;E.color=this.grid.backgroundColor||"#ffffff";E.shadowSizeShow=E.shadowSize;E.shadowSize=0}else{E.color=E.colorShow;E.shadowSize=E.shadowSizeShow}this.redraw();this.updateAction();this.fireEvent(G?"plothide":"plotshow",this,D)}},setSelection:function(B,A){return this.flot.setSelection(B,A)},clearSelection:function(){return this.flot.clearSelection()},setCrosshair:function(A){return this.flot.setCrosshair(A)},clearCrosshair:function(){return this.flot.clearCrosshair()},highlight:function(A,B){return this.flot.highlight(A,B)},unhighlight:function(A,B){return this.flot.unhighlight(A,B)},setData:function(A){return this.flot.setData(A)},setupGrid:function(){return this.flot.setupGrid()},draw:function(){return this.flot.draw()},getData:function(){return(this.flot)?this.flot.getData():this.series},getAxes:function(){return this.flot.getAxes()},getCanvas:function(){return this.flot.getCanvas()},getPlotOffset:function(){return this.flot.getPlotOffset()}});Ext.reg("flot",Ext.ux.Flot);Ext.ns("Ext.ux.Flot.grid");Ext.ux.Flot.grid.weekendMarkings=function(C){var A=[];var D=new Date(C.xaxis.min);D.setUTCDate(D.getUTCDate()-((D.getUTCDay()+1)%7));D.setUTCSeconds(0);D.setUTCMinutes(0);D.setUTCHours(0);var B=D.getTime();do{A.push({xaxis:{from:B,to:B+2*24*60*60*1000}});B+=7*24*60*60*1000}while(B<C.xaxis.max);return A};Ext.ux.FlotPropertyGrid=Ext.extend(Ext.grid.GridPanel,{initComponent:function(){var B=[{header:"X",dataIndex:"xaxis",sortable:true},{header:"X2",dataIndex:"x2axis",hidden:true,sortable:true}];var D=this.flot.getData();for(var C=0,A=D.length;C<A;C++){var E=D[C];var F=function(I,H,J){H.css="background: "+E.color;return I};var G={header:E.label||_("Series")+" "+C,dataIndex:E.label||C,hidden:E.hidden,renderer:F,sortable:true};B.push(Ext.apply(G,this.basePropertyColumn))}Ext.applyIf(this,{border:false,store:this.flot.getStore(),cm:new Ext.grid.ColumnModel(B),sm:new Ext.grid.CellSelectionModel({singleSelect:false}),viewConfig:{emptyText:_("No Data")}});Ext.ux.FlotPropertyGrid.superclass.initComponent.call(this)}});Ext.reg("flotpropertygrid",Ext.ux.FlotPropertyGrid);Ext.ux.PieFlot=Ext.extend(Ext.ux.Flot,{colors:["#59bb14","#39a5fe","#dc5f13","#edc240","#afd8f8","#9440ed"],selection:{mode:null},tooltip:false,contextMenu:[{name:"property",text:_("Property"),iconCls:"puzzle",handler:function(){this.showProperty()}}],datapointContextMenu:false,initComponent:function(){Ext.ux.PieFlot.superclass.initComponent.call(this)},createSeries:function(A,D,C){A=A||this.store;if(typeof D=="undefined"){D=A.xField}if(typeof C=="undefined"){C=A.yField}var B=[];A.each(function(E){this.series.push({label:E.get(this.xField),data:[[0,E.get(this.yField)]]})},{series:B,xField:D,yField:C});return B}});Ext.reg("pieflot",Ext.ux.PieFlot);Ext.ux.BarFlot=Ext.extend(Ext.ux.Flot,{baseSeries:{bars:{show:true,align:"center"}},data:[],tooltip:'<div id="{tipId}">{label}={1}</div>',initComponent:function(){if(this.data){this.setupFlotOptions(this.data)}Ext.ux.BarFlot.superclass.initComponent.call(this)},resetSeries:function(C){var E=["xaxis","x2axis","yaxis","y2axis"];for(var B=0;B<C.length;B++){s=C[B];for(var A in E){var D=E[A];if(s[D]){delete s[D].datamax;delete s[D].datamin;delete s[D].ticks}}if(s.data&&typeof s.data.remove!="function"){Ext.applyIf(s,s.data);delete s.data}s.data=[]}return C},setupData:function(C,D){D=this.resetSeries(D);var I=1/D.length*0.6;var A=D.length/2;this.baseSeries.bars.barWidth=I;for(var E=0;E<C.length;E++){var G=C[E],F=[],K;for(K in G){for(var B=0;B<D.length;B++){var L=D[B];if(L.name==K){var J=D[B].dataIndex;if(typeof J=="undefined"){J=B}var H=E+I*(J-A+0.5);L.data=L.data||[];L.data.push([H,G[K]])}L.label=L.label||G.label||G.name||G.dataIndex}}}return D},setupFlotOptions:function(C){this.data=C;var E=[];for(var B=0,A=C.length;B<A;B++){var D=C[B];E.push([B,D.label||D.name||D.dataIndex])}this.xaxis=this.xaxis||{};Ext.apply(this.xaxis,{ticks:E,min:-0.5,max:B-0.5});this.yaxis=this.yaxis||{};Ext.apply(this.yaxis,{ticks:10,min:0})},updateData:function(B){var A=this.getData();A=this.setupData(B,A);this.setupFlotOptions(B);Ext.ux.BarFlot.superclass.plot.call(this,A)}});Ext.reg("barflot",Ext.ux.BarFlot);Ext.ux.CsvFlot=Ext.extend(Ext.ux.Flot,{header:true,xColumn:0,initComponent:function(){Ext.ux.CsvFlot.superclass.initComponent.call(this)},setupData:function(C,D){var G=this.header;var J=this.xColumn;var N=this.type;var B=this.sortType;if(!C||typeof C.length=="undefined"){G=C.header||G;J=C.xColumn||J;N=C.type||N;B=C.sortType||B;C=C.data}if(typeof C=="string"){C=Csv.parse(C)}var E,L,A,F,K,P;if(typeof G=="boolean"){if(G){G=C.shift()}}else{if(typeof G=="string"){G=Csv.parse(G)[0]}}var O=new Ext.data.JsonStore({});var I=[],H=[];for(E=0,L=G.length;E<L;E++){H.push({name:G[E],type:N,sortType:B})}for(E=0,L=C.length;E<L;E++){var M={};for(A=0,F=C[E].length;A<F;A++){P=G[A]||A;M[P]=C[E][A]}I.push(M)}O.loadData({metaData:{root:"data",totalProperty:"total",successProperty:"success",fields:H},data:I,total:I.length,success:true});O.sort(J,"ASC");var Q=this.createSeries(O,J);if(!D){D=Q}else{for(E=0,L=D.length;E<L;E++){for(A=0,K=Q.length;A<K;A++){P=D[E].dataIndex||D[E].label;if(P==Q[A].dataIndex){D[E].data=Q[A].data;break}}}}this.header=G;this.xColumn=J;return D}});Ext.reg("csvflot",Ext.ux.CsvFlot);if(typeof Csv=="undefined"){Csv={}}Csv.parse=function(A){var C='"',H=",",B="\r",G="\n";var I=[],N=[],L="";var M=false;var K=A.charAt(0);for(var F=0;F<A.length;F++){var E=K;K=(F==A.length-1)?null:A.charAt(F+1);if(E==B){if(K!=G){E=G}if(K==G){continue}}if(M){switch(E){case C:if(K==C){L+=C;F++}else{M=false}break;default:L+=E;break}}else{switch(E){case G:N.push(L);L="";I.push(N);N=[];break;case H:N.push(L);L="";break;case C:if(L===""){M=true;break}default:L+=E;break}}}if(L!==""){N.push(L)}if(N.length>0){I.push(N)}var J=0;for(F=0;F<I.length;F++){J=Math.max(I[F].length,J)}for(F=0;F<I.length;F++){var D=J-I[F].length;for(j=0;j<D;j++){I[F].push("")}}return I};Locale=new (function(){this.messages={};this.setText=function(C,B){var F=navigator.language||navigator.userLanguage||navigator.systemLanguage;if(typeof B=="string"){B=B.split(",")}if(typeof B!="undefined"&&typeof B.indexOf=="function"&&B.indexOf(F)<0){return false}for(var D=0,A=C.length;D<A;D++){var E=C[D];this.messages[E[0]]=E[1]}return true};this.getText=function(A){return this.messages[A]||A};this.getTextNoop=function(A){return A}})();_=function(A){return Locale.getText(A)};N_=function(A){return Locale.getTextNoop(A)};